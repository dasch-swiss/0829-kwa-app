PREFIX knora-api: <http://api.knora.org/ontology/knora-api/simple/v2#> 
PREFIX walser: <http://0.0.0.0:3333/ontology/0829/kwa/simple/v2#>

CONSTRUCT {
        ?textconcept knora-api:isMainResource true;
            walser:hasTitle ?conceptTitle;
            walser:hasKwaConceptId ?conceptId.

		?textexpression walser:hasTitle ?title ;
		    walser:hasIncipit ?incipit ;
		    walser:isTextconceptInstance ?textconcept;
        	walser:standoffResourceTextResourceReference ?textmanifest .
        	
        ?textmanifest walser:hasKwaManifestId ?manifestId.
        
        ?column walser:standoffResourceTextResourceReference ?textmanifest ;
                walser:onSurface ?surface .
                
        ?surface walser:partOfTextcarrier ?textcarrier.
        
        ?textcarrier walser:hasName ?textcarrierName.
        

        ?textcarrier walser:hasNumber ?issueNumber;
                         walser:hasTitle ?issueTitle;
                         walser:hasImprintedDate ?imprintedDate.             
        
        
 }
WHERE
{
        ?textconcept walser:hasTitle ?conceptTitle;
                     walser:hasKwaConceptId ?conceptId.

		?textexpression a walser:Textexpression ;
        	walser:hasTitle ?title ;
        	walser:hasIncipit ?incipit ;
        	walser:isTextconceptInstance ?textconcept;
	        walser:standoffResourceTextResourceReference ?textmanifest .
	     

	      ?textmanifest walser:hasKwaManifestId ?manifestId.
        
        ?column walser:standoffResourceTextResourceReference ?textmanifest ;
                walser:onSurface ?surface .
                
        ?surface walser:partOfTextcarrier ?textcarrier.
        
        ?textcarrier walser:hasName ?textcarrierName.
        
         OPTIONAL {
            ?textcarrier walser:hasNumber ?issueNumber;
                         walser:hasTitle ?issueTitle;
                         walser:hasImprintedDate ?imprintedDate.
        }
	       
	       
	   FILTER knora-api:match(?title, 'Schnee').
	   OPTIONAL
	   {
	    FILTER (?issueTitle = 'Prager Tagblatt').
	   }
} 
ORDER by ?conceptTitle